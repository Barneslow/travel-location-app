{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { useEffect, useState } from \"react\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { Colors } from \"../../constants/GlobalColors\";\nimport { getCurrentPositionAsync, useForegroundPermissions, PermissionStatus } from \"expo-location\";\nimport OutlinedButton from \"../ui/OutlinedButton\";\nimport { getAddress, getMapPreview } from \"../../util/locations\";\nimport { useNavigation, useRoute, useIsFocused } from \"@react-navigation/native\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction LocationPicker(_ref) {\n  var onLocationPicker = _ref.onLocationPicker;\n  var navigation = useNavigation();\n  var route = useRoute();\n  var isFocused = useIsFocused();\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      pickedLocation = _useState2[0],\n      setPickedLocation = _useState2[1];\n\n  var _useForegroundPermiss = useForegroundPermissions(),\n      _useForegroundPermiss2 = _slicedToArray(_useForegroundPermiss, 2),\n      locationPermissionInfo = _useForegroundPermiss2[0],\n      requestPermisson = _useForegroundPermiss2[1];\n\n  useEffect(function () {\n    if (isFocused && route.params) {\n      var mapPickedLocation = {\n        lat: route.params.pickedLat,\n        lng: route.params.pickedLng\n      };\n      setPickedLocation(mapPickedLocation);\n    }\n  }, [route, isFocused]);\n  useEffect(function () {\n    function handleLocation() {\n      var address;\n      return _regeneratorRuntime.async(function handleLocation$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!pickedLocation) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(getAddress(pickedLocation.lat, pickedLocation.lng));\n\n            case 3:\n              address = _context.sent;\n              onLocationPicker(_objectSpread(_objectSpread({}, pickedLocation), {}, {\n                address: address\n              }));\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n\n    handleLocation();\n  }, [pickedLocation, onLocationPicker]);\n\n  function verifyPermission() {\n    var permissionResponse;\n    return _regeneratorRuntime.async(function verifyPermission$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(locationPermissionInfo.status === PermissionStatus.UNDETERMINED)) {\n              _context2.next = 5;\n              break;\n            }\n\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(requestPermisson());\n\n          case 3:\n            permissionResponse = _context2.sent;\n            return _context2.abrupt(\"return\", permissionResponse.granted);\n\n          case 5:\n            if (!(locationPermissionInfo.status === PermissionStatus.DENIED)) {\n              _context2.next = 8;\n              break;\n            }\n\n            Alert.alert(\"Insufficient Permissions!\", \"You need to grant location permissions to use this app\");\n            return _context2.abrupt(\"return\", false);\n\n          case 8:\n            return _context2.abrupt(\"return\", true);\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function findLocationHandler() {\n    var hasPermission, location;\n    return _regeneratorRuntime.async(function findLocationHandler$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(verifyPermission());\n\n          case 2:\n            hasPermission = _context3.sent;\n\n            if (hasPermission) {\n              _context3.next = 5;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 5:\n            _context3.next = 7;\n            return _regeneratorRuntime.awrap(getCurrentPositionAsync({}));\n\n          case 7:\n            location = _context3.sent;\n            setPickedLocation({\n              lat: location.coords.latitude,\n              lng: location.coords.longitude\n            });\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function pickOnMapHandler() {\n    navigation.navigate(\"Map\");\n  }\n\n  var locationPreview = _jsx(Text, {\n    children: \"No Location Picked Yet\"\n  });\n\n  if (pickedLocation) {\n    locationPreview = _jsx(Image, {\n      style: styles.image,\n      source: {\n        uri: getMapPreview(pickedLocation.lat, pickedLocation.lng)\n      }\n    });\n  }\n\n  return _jsxs(View, {\n    children: [_jsx(View, {\n      style: styles.mapPreview,\n      children: locationPreview\n    }), _jsxs(View, {\n      style: styles.actions,\n      children: [_jsx(OutlinedButton, {\n        icon: \"location\",\n        onPress: findLocationHandler,\n        children: \"Locate User\"\n      }), _jsx(OutlinedButton, {\n        icon: \"map\",\n        onPress: pickOnMapHandler,\n        children: \"Pick on Map\"\n      })]\n    })]\n  });\n}\n\nexport default LocationPicker;\nvar styles = StyleSheet.create({\n  mapPreview: {\n    width: \"100%\",\n    height: 200,\n    marginVertical: 8,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: Colors.primary100,\n    borderRadius: 4,\n    overflow: \"hidden\"\n  },\n  actions: {\n    flexDirection: \"row\",\n    justifyContent: \"space-around\",\n    alignItems: \"center\"\n  },\n  image: {\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: 4\n  }\n});","map":{"version":3,"names":["useEffect","useState","Colors","getCurrentPositionAsync","useForegroundPermissions","PermissionStatus","OutlinedButton","getAddress","getMapPreview","useNavigation","useRoute","useIsFocused","LocationPicker","onLocationPicker","navigation","route","isFocused","pickedLocation","setPickedLocation","locationPermissionInfo","requestPermisson","params","mapPickedLocation","lat","pickedLat","lng","pickedLng","handleLocation","address","verifyPermission","status","UNDETERMINED","permissionResponse","granted","DENIED","Alert","alert","findLocationHandler","hasPermission","location","coords","latitude","longitude","pickOnMapHandler","navigate","locationPreview","styles","image","uri","mapPreview","actions","StyleSheet","create","width","height","marginVertical","justifyContent","alignItems","backgroundColor","primary100","borderRadius","overflow","flexDirection"],"sources":["/Users/darrachbarneveld/Downloads/react-native-practical-guide-code-12-native-features/code/02-adding-an-add-place-screen-navigation/components/Places/LocationPicker.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { Alert, Image, StyleSheet, Text, View } from \"react-native\";\nimport { Colors } from \"../../constants/GlobalColors\";\nimport {\n  getCurrentPositionAsync,\n  useForegroundPermissions,\n  PermissionStatus,\n} from \"expo-location\";\nimport OutlinedButton from \"../ui/OutlinedButton\";\nimport { getAddress, getMapPreview } from \"../../util/locations\";\nimport {\n  useNavigation,\n  useRoute,\n  useIsFocused,\n} from \"@react-navigation/native\";\n\nfunction LocationPicker({ onLocationPicker }) {\n  const navigation = useNavigation();\n  const route = useRoute();\n  const isFocused = useIsFocused();\n\n  const [pickedLocation, setPickedLocation] = useState();\n  const [locationPermissionInfo, requestPermisson] = useForegroundPermissions();\n\n  useEffect(() => {\n    if (isFocused && route.params) {\n      const mapPickedLocation = {\n        lat: route.params.pickedLat,\n        lng: route.params.pickedLng,\n      };\n      setPickedLocation(mapPickedLocation);\n    }\n  }, [route, isFocused]);\n\n  useEffect(() => {\n    async function handleLocation() {\n      if (pickedLocation) {\n        const address = await getAddress(\n          pickedLocation.lat,\n          pickedLocation.lng\n        );\n        onLocationPicker({ ...pickedLocation, address: address });\n      }\n    }\n\n    handleLocation();\n  }, [pickedLocation, onLocationPicker]);\n\n  async function verifyPermission() {\n    if (locationPermissionInfo.status === PermissionStatus.UNDETERMINED) {\n      const permissionResponse = await requestPermisson();\n\n      return permissionResponse.granted;\n    }\n\n    if (locationPermissionInfo.status === PermissionStatus.DENIED) {\n      Alert.alert(\n        \"Insufficient Permissions!\",\n        \"You need to grant location permissions to use this app\"\n      );\n\n      return false;\n    }\n\n    return true;\n  }\n\n  async function findLocationHandler() {\n    const hasPermission = await verifyPermission();\n\n    if (!hasPermission) return;\n\n    const location = await getCurrentPositionAsync({});\n\n    setPickedLocation({\n      lat: location.coords.latitude,\n      lng: location.coords.longitude,\n    });\n  }\n\n  function pickOnMapHandler() {\n    navigation.navigate(\"Map\");\n  }\n\n  let locationPreview = <Text>No Location Picked Yet</Text>;\n\n  if (pickedLocation) {\n    locationPreview = (\n      <Image\n        style={styles.image}\n        source={{\n          uri: getMapPreview(pickedLocation.lat, pickedLocation.lng),\n        }}\n      />\n    );\n  }\n\n  return (\n    <View>\n      <View style={styles.mapPreview}>{locationPreview}</View>\n      <View style={styles.actions}>\n        <OutlinedButton icon=\"location\" onPress={findLocationHandler}>\n          Locate User\n        </OutlinedButton>\n        <OutlinedButton icon=\"map\" onPress={pickOnMapHandler}>\n          Pick on Map\n        </OutlinedButton>\n      </View>\n    </View>\n  );\n}\n\nexport default LocationPicker;\n\nconst styles = StyleSheet.create({\n  mapPreview: {\n    width: \"100%\",\n    height: 200,\n    marginVertical: 8,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: Colors.primary100,\n    borderRadius: 4,\n    overflow: \"hidden\",\n  },\n  actions: {\n    flexDirection: \"row\",\n    justifyContent: \"space-around\",\n    alignItems: \"center\",\n  },\n\n  image: {\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: 4,\n  },\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}